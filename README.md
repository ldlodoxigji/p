# Панель мониторинга и скрейпер

Этот проект объединяет скрейпинг данных интернет-магазинов, сохранение в SQLite через Sequelize и кластеризованный HTTP-сервер, который рендерит адаптивные страницы с диаграммами.

## Как пользоваться по шагам

1. **Установите зависимости**  
   Требуется Node.js 18+. Выполните `npm install` в корне проекта.

2. **Подготовьте данные**  
   - Для единоразовой выгрузки выполните `npm run scrape` (запускает `scraper.js`).
   - Для периодического сбора данных поднимите расписание: `npm run schedule` (использует `schedule.js`).
   - База данных по умолчанию — файл `database.sqlite` в корне. Его можно заменить своим, если структуры моделей совпадают.

3. **Запустите сервер**  
   - По умолчанию используется кластер на всех доступных ядрах: `npm start` (`server.js`).
   - Для одиночного процесса (например, в среде разработки) можно использовать `npm run serve:single`.
   - Переменные окружения: `PORT` (по умолчанию 3000) и `HOST` (по умолчанию `0.0.0.0`).

4. **Откройте веб-страницы**  
   - `/` — обзор с KPI, таблицей и готовыми данными для графиков.
   - `/chart1` и `/chart2` — отдельные страницы с визуализациями Chart.js. Клиентский JS получает данные из сервера или встроенного payload и строит разные типы диаграмм.
   - `/api/products` — JSON API со списком нормализованных товаров.

5. **Проверяйте отображение**  
   Шаблоны используют адаптивную вёрстку; сверяйте страницы на десктопе и мобильных устройствах. При обновлении данных просто перезапустите скрейпинг/расписание — сервер подхватит свежие записи из базы при следующем запросе.

6. **Эксплуатация и масштабирование**  
   Кластерный режим автоматически перезапускает воркеры при падении. Для продакшена можно использовать `pm2`: `npm run pm2` (берёт конфигурацию из `ecosystem.config.js`).

## Структура

- `server.js` — кластерный HTTP-сервер со статикой, маршрутами страниц и API.
- `services/analyticsService.js` — нормализация данных и подготовка агрегатов для KPI/диаграмм.
- `views/` — HTML-шаблоны страниц с плейсхолдерами payload.
- `public/js/` — клиентские скрипты для вывода KPI, таблиц и диаграмм.
- `models/` — ORM-модели Sequelize и подключение к SQLite.
- `scraper.js`, `schedule.js`, `saveToDb.js` — сбор и сохранение данных из магазинов.

